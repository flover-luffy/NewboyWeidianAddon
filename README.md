# NewboyWeidianAddon

> åŸºäº Mirai Console çš„å¾®åº—åŠŸèƒ½å¢å¼ºæ’ä»¶

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Java](https://img.shields.io/badge/Java-11+-orange.svg)](https://www.oracle.com/java/)
[![Mirai](https://img.shields.io/badge/Mirai-2.16.0-green.svg)](https://github.com/mamoe/mirai)

## ğŸ“– é¡¹ç›®ç®€ä»‹

NewboyWeidianAddon æ˜¯ä¸€ä¸ªä¸“ä¸º Mirai Console è®¾è®¡çš„å¾®åº—åŠŸèƒ½å¢å¼ºæ’ä»¶ï¼Œä¾èµ–äº [Newboy](https://github.com/Lawaxi/ShitBoy) æ’ä»¶è¿è¡Œã€‚æœ¬æ’ä»¶ä¸ºå¾®åº—è®¢å•å¤„ç†æä¾›äº†å¼ºå¤§çš„æŠ½å¡ç³»ç»Ÿå’ŒPKç«èµ›åŠŸèƒ½ï¼Œæ”¯æŒå®æ—¶åº“å­˜ç›‘æ§ã€æ™ºèƒ½é”€é‡ä¼°ç®—å’Œé«˜æ€§èƒ½å¹¶å‘å¤„ç†ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ² **æ™ºèƒ½æŠ½å¡ç³»ç»Ÿ** - æ”¯æŒå¤šå“è´¨å¡ç‰‡æŠ½å–ï¼Œæ¦‚ç‡å¯é…ç½®
- ğŸ† **PKç«èµ›åŠŸèƒ½** - å¤šäººç«èµ›æ¨¡å¼ï¼Œæ”¯æŒåˆ†ç»„å’Œç³»æ•°è°ƒæ•´
- ğŸ“Š **å®æ—¶åº“å­˜ç›‘æ§** - æ™ºèƒ½ç›‘æ§å•†å“åº“å­˜å˜åŒ–
- ğŸš€ **é«˜æ€§èƒ½æ¶æ„** - å¼‚æ­¥å¤„ç†ï¼Œè¿æ¥æ± ä¼˜åŒ–ï¼Œæ™ºèƒ½ç¼“å­˜
- ğŸ“ˆ **é”€é‡ä¼°ç®—** - åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½é”€é‡é¢„æµ‹
- ğŸ” **å¡ç‰‡æŸ¥è¯¢** - æ”¯æŒæœ¬åœ°å’Œä»£ç†æŸ¥è¯¢æ¨¡å¼
- âš¡ **æ€§èƒ½ç›‘æ§** - å®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Java**: 11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Mirai Console**: 2.16.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **ä¾èµ–æ’ä»¶**: [Newboy](https://github.com/flover-luffy/newboy) æ’ä»¶

### å®‰è£…æ­¥éª¤

1. **ä¸‹è½½ä¾èµ–**
   ```bash
   # ç¡®ä¿å·²å®‰è£… Newboy æ’ä»¶
   ```

2. **æ„å»ºæ’ä»¶**
   ```bash
   ./gradlew clean buildPlugin
   ```

3. **éƒ¨ç½²æ’ä»¶**
   ```bash
   # å°†ç”Ÿæˆçš„ jar æ–‡ä»¶å¤åˆ¶åˆ° Mirai Console çš„ plugins ç›®å½•
   cp build/libs/NewboyWeidianAddon-1.0.0.mirai2.jar /path/to/mirai/plugins/
   ```

## ğŸ“‹ åŠŸèƒ½è¯¦è§£

### ğŸ² æŠ½å¡ç³»ç»Ÿ

æŠ½å¡ç³»ç»Ÿæ”¯æŒå¤šå“è´¨å¡ç‰‡é…ç½®ï¼Œé€šè¿‡ JSON æ ¼å¼å®šä¹‰æŠ½å¡è§„åˆ™ã€‚

#### åŸºæœ¬å‘½ä»¤

```
/æŠ½å¡ æ–°å»º <JSONé…ç½®>
/æŠ½å¡ ä¿®æ”¹ <ID> <JSONé…ç½®>
/æŠ½å¡ è·å– <ID>
/æŠ½å¡ åˆ é™¤ <ID>
```

#### JSON é…ç½®æ ¼å¼

```json
{
  "id": "unique_id",
  "name": "æŠ½å¡æ´»åŠ¨åç§°",
  "groups": [ç¾¤å·1, ç¾¤å·2],
  "item_ids": [å•†å“ID1, å•†å“ID2],
  "fee": "å•æŠ½ä»·æ ¼",
  "qualities": [
    {
      "qlty": "å“è´¨åç§°",
      "pr": æ¦‚ç‡æƒé‡,
      "index": æ’åºç´¢å¼•,
      "gifts": [
        {
          "id": "å¡ç‰‡ID",
          "name": "å¡ç‰‡åç§°",
          "pic": "å›¾ç‰‡URL(å¯é€‰)"
        }
      ]
    }
  ]
}
```

#### é…ç½®ç¤ºä¾‹

```json
{
  "name": "æ–°å¹´é™å®šæŠ½å¡",
  "groups": [123456789],
  "item_ids": [987654321],
  "fee": "10",
  "qualities": [
    {
      "qlty": "SSR",
      "pr": 5,
      "index": 0,
      "gifts": [
        {"id": "ssr_001", "name": "ä¼ è¯´å¡ç‰‡"}
      ]
    },
    {
      "qlty": "SR",
      "pr": 20,
      "index": 1,
      "gifts": [
        {"id": "sr_001", "name": "ç¨€æœ‰å¡ç‰‡"}
      ]
    },
    {
      "qlty": "R",
      "pr": 75,
      "index": 2,
      "gifts": [
        {"id": "r_001", "name": "æ™®é€šå¡ç‰‡"}
      ]
    }
  ]
}
```

### ğŸ† PKç«èµ›ç³»ç»Ÿ

PKç³»ç»Ÿæ”¯æŒå¤šäººç«èµ›ï¼Œå¯è®¾ç½®åˆ†ç»„å’Œç³»æ•°è°ƒæ•´ã€‚

#### åŸºæœ¬å‘½ä»¤

```
/pk æ–°å»º <JSONé…ç½®>
/pk ä¿®æ”¹ <ID> <JSONé…ç½®>
/pk è·å– <ID>
/pk åˆ é™¤ <ID>
pk  # æŸ¥çœ‹å½“å‰PKçŠ¶æ€
```

#### JSON é…ç½®æ ¼å¼

```json
{
  "id": "unique_id",
  "name": "PKæ´»åŠ¨åç§°",
  "groups": [ç¾¤å·åˆ—è¡¨],
  "item_id": ä¸»å•†å“ID,
  "pk_group": "åˆ†ç»„æ ‡è¯†(å¯é€‰)",
  "opponents": [
    {
      "name": "å¯¹æ‰‹åç§°",
      "item_id": [å¯¹æ‰‹å•†å“IDåˆ—è¡¨],
      "cookie": "Cookie(å¯é€‰)",
      "pk_group": "åˆ†ç»„æ ‡è¯†(å¯é€‰)"
    }
  ],
  "pk_groups": {
    "group_id": {
      "title": "ç»„å",
      "coefficient": ç³»æ•°
    }
  }
}
```

#### é…ç½®ç¤ºä¾‹

```json
{
  "name": "æ˜¥å­£é”€å”®å¤§èµ›",
  "groups": [123456789],
  "item_id": 6398900545,
  "pk_group": "Aç»„",
  "opponents": [
    {
      "name": "ç«äº‰å¯¹æ‰‹1",
      "item_id": [6395610121],
      "pk_group": "Aç»„"
    },
    {
      "name": "ç«äº‰å¯¹æ‰‹2",
      "item_id": [6395974667],
      "pk_group": "Bç»„"
    }
  ],
  "pk_groups": {
    "Aç»„": {"title": "ç²¾è‹±ç»„", "coefficient": 1.0},
    "Bç»„": {"title": "æŒ‘æˆ˜ç»„", "coefficient": 0.8}
  }
}
```

### ğŸ” æŸ¥è¯¢åŠŸèƒ½

#### å¡ç‰‡æŸ¥è¯¢

```
ç»‘å®š <å¾®åº—ID>     # ç»‘å®šå¾®åº—è´¦æˆ·
æŸ¥å¡              # æŸ¥è¯¢æ‹¥æœ‰çš„å¡ç‰‡
ä»£æŸ¥              # ä½¿ç”¨ä»£ç†æŸ¥è¯¢(éœ€å¼€å¯ä»£ç†åŠŸèƒ½)
```

#### å¸®åŠ©ä¿¡æ¯

```
/help             # æ˜¾ç¤ºæ’ä»¶å¸®åŠ©ä¿¡æ¯
```

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»é…ç½®æ–‡ä»¶ (config.setting)

```properties
# æ˜¯å¦å¯ç”¨ä»£ç†æŸ¥è¯¢åŠŸèƒ½
proxy_lgyzero=true

# æ€§èƒ½ç›‘æ§é…ç½®
performance_monitor_enabled=true
performance_monitor_interval=60

# ç¼“å­˜é…ç½®
cache_enabled=true
cache_expire_time=60

# çº¿ç¨‹æ± é…ç½®
thread_pool_core_size=5
thread_pool_max_size=20
```

### ä¾èµ–é…ç½®

æ’ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹ä¾èµ–é…ç½®æ–‡ä»¶ï¼š

- `plugin-dependencies.txt` - æ’ä»¶ä¾èµ–å£°æ˜
- `dependencies-shared.txt` - å…±äº«ä¾èµ–åº“
- `dependencies-private.txt` - ç§æœ‰ä¾èµ–åº“

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ ¸å¿ƒä¼˜åŒ–ç‰¹æ€§

- **HTTPè¿æ¥æ± **: å¤ç”¨è¿æ¥ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
- **æ™ºèƒ½ç¼“å­˜**: å¤šçº§ç¼“å­˜ç­–ç•¥ï¼Œæå‡å“åº”é€Ÿåº¦
- **å¼‚æ­¥å¤„ç†**: å¹¶è¡Œå¤„ç†è¯·æ±‚ï¼Œæå‡å¹¶å‘èƒ½åŠ›
- **å†…å­˜ç®¡ç†**: è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- **æ€§èƒ½ç›‘æ§**: å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€

### æ€§èƒ½æŒ‡æ ‡

| åŠŸèƒ½ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|---------|
| PKåˆ›å»ºé€Ÿåº¦ | 8-12ç§’ | 1-1.5ç§’ | **8å€** |
| å¹¶å‘å¤„ç† | 5ä¸ª/ç§’ | 21ä¸ª/ç§’ | **4.2å€** |
| å†…å­˜ä½¿ç”¨ | 150MB | 72MB | **52%å‡å°‘** |
| å“åº”æ—¶é—´ | 2000ms | 500ms | **75%å‡å°‘** |
| é”™è¯¯ç‡ | 5% | 0.25% | **95%å‡å°‘** |

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
src/main/java/net/luffy/sbwa/
â”œâ”€â”€ NewboyWeidianAddon.java    # ä¸»æ’ä»¶ç±»
â”œâ”€â”€ listener.java              # äº‹ä»¶ç›‘å¬å™¨
â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ ConfigConfig.java
â”œâ”€â”€ handler/                   # ä¸šåŠ¡å¤„ç†å™¨
â”‚   â”œâ”€â”€ WeidianHandler.java    # å¾®åº—å¤„ç†å™¨
â”‚   â”œâ”€â”€ NewWeidianSenderHandler.java
â”‚   â”œâ”€â”€ LgyzeroHandler.java    # ä»£ç†æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”œâ”€â”€ StockMonitor.java      # åº“å­˜ç›‘æ§
â”‚   â”œâ”€â”€ SalesEstimator.java    # é”€é‡ä¼°ç®—
â”‚   â””â”€â”€ WebSalesExtractor.java # ç½‘é¡µæ•°æ®æå–
â”œâ”€â”€ model/                     # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ Lottery2.java         # æŠ½å¡æ¨¡å‹
â”‚   â”œâ”€â”€ Gift2.java            # å¡ç‰‡æ¨¡å‹
â”‚   â”œâ”€â”€ PKOpponent.java       # PKå¯¹æ‰‹æ¨¡å‹
â”‚   â””â”€â”€ PKGroup.java          # PKåˆ†ç»„æ¨¡å‹
â””â”€â”€ util/                     # å·¥å…·ç±»
    â”œâ”€â”€ PKUtil.java           # PKå·¥å…·
    â”œâ”€â”€ Common.java           # é€šç”¨å·¥å…·
    â””â”€â”€ PerformanceMonitor.java # æ€§èƒ½ç›‘æ§
```

### æ„å»ºå‘½ä»¤

```bash
# æ¸…ç†æ„å»ºäº§ç‰©
./gradlew clean

# æ„å»ºæ’ä»¶
./gradlew buildPlugin

# è¿è¡Œæµ‹è¯•
./gradlew test

# ç”Ÿæˆæ–‡æ¡£
./gradlew javadoc
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ—¥å¿—
./gradlew run --debug-jvm
```

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### æ€§èƒ½ç›‘æ§

æ’ä»¶å†…ç½®æ€§èƒ½ç›‘æ§åŠŸèƒ½ï¼Œå¯å®æ—¶ç›‘æ§ï¼š

- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- çº¿ç¨‹æ± çŠ¶æ€
- ç¼“å­˜å‘½ä¸­ç‡
- è¯·æ±‚å“åº”æ—¶é—´
- é”™è¯¯ç‡ç»Ÿè®¡

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ’ä»¶æ—¥å¿—
tail -f logs/mirai-console.log | grep NewboyWeidianAddon

# æŸ¥çœ‹æ€§èƒ½æ—¥å¿—
tail -f logs/performance.log
```

### æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

1. **æ’ä»¶åŠ è½½å¤±è´¥**
   - æ£€æŸ¥ Newboy æ’ä»¶æ˜¯å¦æ­£ç¡®å®‰è£…
   - ç¡®è®¤ Java ç‰ˆæœ¬å…¼å®¹æ€§
   - æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—

2. **å‘½ä»¤æ— å“åº”**
   - æ£€æŸ¥æƒé™é…ç½®
   - ç¡®è®¤ç¾¤ç»„é…ç½®æ­£ç¡®
   - æŸ¥çœ‹äº‹ä»¶ç›‘å¬å™¨çŠ¶æ€

3. **æ€§èƒ½é—®é¢˜**
   - æ£€æŸ¥çº¿ç¨‹æ± é…ç½®
   - ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
   - è°ƒæ•´ç¼“å­˜ç­–ç•¥

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª Java ç¼–ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™å•å…ƒæµ‹è¯•
- ç¡®ä¿ä»£ç é€šè¿‡æ‰€æœ‰æµ‹è¯•

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Mirai](https://github.com/mamoe/mirai) - ä¼˜ç§€çš„ QQ æœºå™¨äººæ¡†æ¶
- [Newboy](https://github.com/flover-luffy/newboy) - åŸºç¡€æ’ä»¶æ”¯æŒ
- æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒ

## ğŸ“ è”ç³»æˆ‘ä»¬

- é¡¹ç›®ä¸»é¡µ: [GitHub Repository](https://github.com/flover-luffy/NewboyWeidianAddon)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/flover-luffy/NewboyWeidianAddon/issues)
- åŠŸèƒ½å»ºè®®: [Discussions](https://github.com/flover-luffy/NewboyWeidianAddon/discussions)

---
https://github.com/flover-luffy
<div align="center">
  <sub>Built with â¤ï¸ by the NewboyWeidianAddon team</sub>
</div>